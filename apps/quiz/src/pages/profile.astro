---
import Layout from "../layouts/Layout.astro";
import ScoreHistory from "../components/ScoreHistory";
import ProfileActions from "../components/ProfileActions";
---

<Layout title="Profile" description="View your quiz history and statistics.">
  <h1 class="text-3xl font-bold text-quiz-text mb-2">Your Profile</h1>
  <p class="text-quiz-text-muted mb-8">Track your quiz performance</p>

  <ProfileActions client:load />

  <div id="auth-check" class="hidden mt-8">
    <ScoreHistory client:load />
  </div>

  <script>
    import { supabase } from "../lib/supabase";

    const authCheck = document.getElementById("auth-check");

    supabase.auth.getSession().then(({ data: { session } }) => {
      if (session) {
        authCheck?.classList.remove("hidden");
      } else {
        authCheck?.classList.add("hidden");
      }
    });

    supabase.auth.onAuthStateChange((_event, session) => {
      if (session) {
        authCheck?.classList.remove("hidden");
      } else {
        authCheck?.classList.add("hidden");
      }
    });
  </script>
</Layout>
